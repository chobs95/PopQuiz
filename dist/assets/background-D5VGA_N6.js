chrome.runtime.onMessage.addListener(function(t,s,e){t.message==="myMessage"&&console.log("recieved message")});chrome.action.onClicked.addListener(t=>{let s={txt:"hello"};chrome.tabs.sendMessage(t.id,s)});console.log("after listener!");chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"saveHighlight",title:"Save highlighted text for PopQuiz",contexts:["selection"]})});chrome.contextMenus.onClicked.addListener((t,s)=>{console.log(t.menuItemId),console.log(s),t.menuItemId==="saveHighlight"&&(chrome.storage.local.get({highlights:[]},e=>{const o=[...e.highlights,t.selectionText];chrome.storage.local.set({highlights:o},()=>{console.log("Text saved:",t.selectionText),chrome.notifications.create({type:"basic",iconUrl:"images/popQuiz_128.png",title:"PopQuiz",message:"Highlighted text saved!"})})}),chrome.scripting.executeScript({target:{tabId:s.id},func:c,args:[t.selectionText]}))});function c(t){function s(o){console.log("undo button pressed"),data=chrome.storage.local.get("highlights",l=>{const n=l.highlights;if(n.length>0){n.pop(),chrome.storage.local.set({highlights:n});const i=o.querySelector("#floatingMessage");console.log(i),i?i.textContent=`Prompt "${t}" was removed`:console.log("no message found")}}),setTimeout(()=>{o.remove()},2e3)}const e=document.createElement("div");e.style.position="fixed",e.style.top="10px",e.style.right="10px",e.style.width="auto",e.style.height="auto",e.style.zIndex="9999",e.style.boxShadow="0 4px 10px rgba(0, 0, 0, 0.5)",fetch(chrome.runtime.getURL("floatingUI.html")).then(o=>o.text()).then(o=>{e.innerHTML=o,document.body.appendChild(e),e.querySelector("#closeButton").addEventListener("click",()=>e.remove()),e.querySelector("#undoButton").addEventListener("click",()=>s(e)),setTimeout(()=>{e.remove()},5e3)}).catch(o=>console.error("Error loading floating UI:",o))}
